<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Medicaid Fraud Audit | Public Transparency Tool</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    :root { --bg: #0a0a0a; --fg: #ededed; --accent: #00ff88; --warning: #ff6b6b; --muted: #666; --card-bg: #111; --border: #222; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: var(--bg); color: var(--fg); line-height: 1.6; padding: 2rem; }
    .container { max-width: 1400px; margin: 0 auto; }
    h1 { font-size: 2.5rem; margin-bottom: 0.5rem; }
    .subtitle { color: var(--muted); font-size: 1.1rem; margin-bottom: 2rem; }
    .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem; }
    .stat-card { background: var(--card-bg); border: 1px solid var(--border); padding: 1.5rem; border-radius: 8px; }
    .stat-card .label { color: var(--muted); font-size: 0.85rem; text-transform: uppercase; }
    .stat-card .value { font-size: 2rem; font-weight: 700; color: var(--accent); }
    .section { margin-bottom: 3rem; }
    .section h2 { font-size: 1.5rem; margin-bottom: 1rem; }
    .flag-count { background: var(--warning); color: var(--bg); padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.85rem; margin-left: 0.5rem; }
    table { width: 100%; border-collapse: collapse; font-size: 0.9rem; background: var(--card-bg); }
    th, td { padding: 0.75rem 1rem; text-align: left; border-bottom: 1px solid var(--border); }
    th { background: #1a1a1a; font-weight: 600; text-transform: uppercase; font-size: 0.7rem; color: var(--muted); }
    tr:hover { background: rgba(255,255,255,0.02); }
    .provider-name { font-weight: 600; color: var(--fg); }
    .provider-name a { color: var(--fg); text-decoration: none; }
    .provider-name a:hover { color: var(--accent); text-decoration: underline; }
    .npi { font-family: monospace; color: var(--muted); font-size: 0.8rem; }
    .location { color: var(--muted); font-size: 0.85rem; }
    .money { font-family: monospace; color: var(--accent); }
    .high-risk { color: var(--warning); font-weight: 600; }
    .badge { display: inline-block; padding: 0.2rem 0.4rem; border-radius: 4px; font-size: 0.65rem; font-weight: 600; text-transform: uppercase; }
    .badge-outlier { background: rgba(255,107,107,0.2); color: var(--warning); }
    .badge-volume { background: rgba(255,193,7,0.2); color: #ffc107; }
    .badge-ghost { background: rgba(156,39,176,0.2); color: #ce93d8; }
    .footer { margin-top: 4rem; padding-top: 2rem; border-top: 1px solid var(--border); color: var(--muted); font-size: 0.85rem; }
    .footer a { color: var(--accent); }
    .loading { text-align: center; padding: 4rem; color: var(--muted); }
    .type-tag { font-size: 0.7rem; color: var(--muted); background: var(--border); padding: 0.15rem 0.4rem; border-radius: 3px; margin-left: 0.5rem; }
  </style>
</head>
<body>
  <div class="container">
    <h1>üè• Medicaid Fraud Audit</h1>
    <p class="subtitle">Public transparency tool analyzing Medicaid provider spending (2018-2024)</p>
    
    <div id="content" class="loading">Loading analysis data...</div>
  </div>

  <script>
    const formatMoney = (n) => {
      if (n >= 1e9) return `$${(n/1e9).toFixed(2)}B`;
      if (n >= 1e6) return `$${(n/1e6).toFixed(2)}M`;
      if (n >= 1e3) return `$${(n/1e3).toFixed(1)}K`;
      return `$${n.toFixed(2)}`;
    };
    const formatNumber = (n) => new Intl.NumberFormat().format(n);
    
    async function loadData() {
      try {
        const [statsRes, flagsRes] = await Promise.all([
          fetch('basic-stats.json'),
          fetch('fraud-flags.json')
        ]);
        const stats = await statsRes.json();
        const flags = await flagsRes.json();
        render(stats, flags);
      } catch(e) {
        document.getElementById('content').innerHTML = 'Error loading data: ' + e.message;
      }
    }
    
    function providerCell(r) {
      const name = r.provider_name || 'Unknown Provider';
      const loc = r.state ? `${r.city || ''}, ${r.state}`.replace(/^, /, '') : '';
      const type = r.provider_type === 'Organization' ? 'Org' : 'Individual';
      return `
        <td>
          <div class="provider-name">
            <a href="https://npiregistry.cms.hhs.gov/provider-view/${r.npi}" target="_blank">${name}</a>
            <span class="type-tag">${type}</span>
          </div>
          <div class="npi">NPI: ${r.npi}${loc ? ' ¬∑ ' + loc : ''}</div>
        </td>
      `;
    }
    
    function render(stats, flags) {
      const totalFlagged = flags.summary.high_volume_outliers + flags.summary.impossible_volume + flags.summary.ghost_patient_patterns;
      
      document.getElementById('content').innerHTML = `
        <div class="stats-grid">
          <div class="stat-card"><div class="label">Total Analyzed</div><div class="value">${formatMoney(stats.total_paid)}</div></div>
          <div class="stat-card"><div class="label">Providers Analyzed</div><div class="value">${formatNumber(stats.unique_billing_providers)}</div></div>
          <div class="stat-card"><div class="label">Flagged for Review</div><div class="value" style="color:var(--warning)">${formatNumber(totalFlagged)}</div></div>
          <div class="stat-card"><div class="label">Time Period</div><div class="value" style="font-size:1.2rem">${stats.earliest_month} ‚Äì ${stats.latest_month}</div></div>
        </div>
        
        <div class="section">
          <h2>üö® Statistical Outliers <span class="flag-count">${flags.summary.high_volume_outliers}</span></h2>
          <p style="color:var(--muted);margin-bottom:1rem;font-size:0.9rem">Providers with payments more than 5 standard deviations above the mean</p>
          <table>
            <thead><tr><th>Provider</th><th>Total Paid</th><th>Claims</th><th>Z-Score</th><th>Flag</th></tr></thead>
            <tbody>
              ${flags.flags.high_volume_outliers.slice(0,30).map(r => `
                <tr>
                  ${providerCell(r)}
                  <td class="money">${formatMoney(r.total_paid)}</td>
                  <td>${formatNumber(r.total_claims)}</td>
                  <td class="high-risk">${r.paid_zscore?.toFixed(1)}œÉ</td>
                  <td><span class="badge badge-outlier">OUTLIER</span></td>
                </tr>
              `).join('')}
            </tbody>
          </table>
        </div>
        
        <div class="section">
          <h2>‚ö° Impossible Daily Volumes <span class="flag-count">${flags.summary.impossible_volume}</span></h2>
          <p style="color:var(--muted);margin-bottom:1rem;font-size:0.9rem">Providers averaging more than 100 claims per working day in a month</p>
          <table>
            <thead><tr><th>Provider</th><th>Peak Month</th><th>Monthly Claims</th><th>Claims/Day</th><th>Flag</th></tr></thead>
            <tbody>
              ${flags.flags.impossible_volume.slice(0,30).map(r => `
                <tr>
                  ${providerCell(r)}
                  <td>${r.peak_month?.slice(0,7) || 'N/A'}</td>
                  <td>${formatNumber(r.monthly_claims)}</td>
                  <td class="high-risk">${r.claims_per_day?.toFixed(0)}/day</td>
                  <td><span class="badge badge-volume">HIGH VOLUME</span></td>
                </tr>
              `).join('')}
            </tbody>
          </table>
        </div>
        
        <div class="section">
          <h2>üëª Ghost Patient Patterns <span class="flag-count">${flags.summary.ghost_patient_patterns}</span></h2>
          <p style="color:var(--muted);margin-bottom:1rem;font-size:0.9rem">Providers with more than 50 claims per unique patient (potential repeat billing)</p>
          <table>
            <thead><tr><th>Provider</th><th>Total Claims</th><th>Unique Patients</th><th>Claims/Patient</th><th>Flag</th></tr></thead>
            <tbody>
              ${flags.flags.ghost_patient_patterns.slice(0,30).map(r => `
                <tr>
                  ${providerCell(r)}
                  <td>${formatNumber(r.total_claims)}</td>
                  <td>${formatNumber(r.total_beneficiaries)}</td>
                  <td class="high-risk">${r.claims_per_beneficiary?.toFixed(0)}x</td>
                  <td><span class="badge badge-ghost">GHOST</span></td>
                </tr>
              `).join('')}
            </tbody>
          </table>
        </div>
        
        <div class="footer">
          <p><strong>Data Source:</strong> <a href="https://opendata.hhs.gov/datasets/medicaid-provider-spending/" target="_blank">HHS Open Data - Medicaid Provider Spending</a> (T-MSIS)</p>
          <p><strong>Analysis Date:</strong> ${flags.generated_at}</p>
          <p style="margin-top:1rem"><em>‚ö†Ô∏è These flags indicate statistical anomalies that warrant further investigation. They do not constitute proof of fraud. Provider names obtained from NPI Registry.</em></p>
        </div>
      `;
    }
    
    loadData();
  </script>
</body>
</html>
